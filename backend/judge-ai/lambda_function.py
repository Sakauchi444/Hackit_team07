import json
# import pymysql
from poe_api_wrapper import PoeApi

client = PoeApi("QBjYOY5ONFVv59P-B7HaOw%3D%3D")
# client = PoeApi(<poe_api_key>)

# Configuration for your RDS database
endpoint = 'database-1.cvccqeo2slwn.ap-northeast-1.rds.amazonaws.com'
username = 'admin'
password = 'qwer1234'
database_name = 'hackit'

# Connection setup for RDS
# connection = pymysql.connect(host=endpoint, user=username, passwd=password, db=database_name)

def lambda_handler(event, context):
    
    ## input
    body = json.loads(event['body']) # {"Name":"Tanaka", "Age":"100"}こんな感じのがくる．
    conversation_id = str(body['conversationId'])
    
    # with connection.cursor() as cursor:
    #     query = """
    #         SELECT Positions.name, Comments.content FROM Comments
    #             JOIN Sections ON Comments.section_id = Sections.id
    #             JOIN Positions ON Sections.position_id = Positions.id
    #             WHERE Comments.conversation_id = %s
    #             ORDER BY Comments.section_id ASC;
    #     """
        
    #     cursor.execute(query, (conversation_id,))
    #     results_comments = cursor.fetchall()
        
    #     query = "SELECT title FROM Conversations WHERE id=%s;"
    #     cursor.execute(query, (conversation_id,))
    #     result_title = cursor.fetchone()

    # # Make sure to close the connection if you're done with it or it's not being managed elsewhere
    # connection.close()
    results_comments="sasasa\\nsdasdandsdsfsd\\n"
    m = results_comments.replace('\\n', '')
    #  """
    #  (('肯定', '### 現状分析\\niPhoneは市場において高いシェアを占め、その使いやすさ、セキュリティ、
    #  そしてエコシステムの統合性で多くのユーザーから支持されています。\\n\\n### 現状における問題点\\n一方で、
    #  高価格帯に位置するiPhoneは、コスト面でAndroidに比べて不利な点があります。また、ハードウェアのカスタマイズ性に欠け
    #  、一部のユーザーからの不満があります。\\n\\n### 問題解決のためのプラン\\nアップルはコストパフォーマンスに優れたモ
    #  デルの提供を拡大し、ユーザーインターフェースのカスタマイズ性を高めることで、より多様なニーズに応える計画です。\\n\\n
    #  ### プラン導入後のメリット\\nこれにより、iPhoneは更に幅広い層に受け入れられ、セキュリティやプライバシーを重視するユーザ
    #  ーにとって最適な選択肢となるでしょう。\\n\\n### デメリット\\nデメリットは、カスタマイズ性の向上が完全ではないことや、Androi
    #  dとの競争がさらに激化する可能性があります。\\n\\n---\\n\\niPhoneはその独自のIOSシステムによって、セキュリティ面での強みを持ち
    #  ます。アップルのプライバシーに対する取り組みは業界をリードしており、ユーザーのデータ保護において信頼性が高いと言えるでしょう。ま
    #  た、アプリの質はApp Storeの厳格な審査プロセスによって保たれ、ユーザーエクスペリエンスは安定しています。シームレスなデバイス間の連携
    #  は、生産性と便利さを高めます。そのため、iPhoneはユーザーにとって、セキュリティ、信頼性、そして一貫したエクスペリエンスを提供する、
    #  優れたスマートフォンであると考えられます。'), ('否定', '### Androidの優位性\\n\\niPhoneがユーザーフレンドリーでセキュリティが強固
    #  であることは認められますが、Androidはこれらの要素を損なうことなく、更なる自由度と利便性を提供しています。\\n\\n### コストと多様性\
    #  \n\\nまず、コスト面では、Androidは幅広い価格帯のデバイスを提供しており、予算に応じてユーザーは自由に選択できます。このアクセシビリティは、
    #  技術をより民主化し、多様な社会経済的背景を持つ人々にスマートフォンを手に入れる機会を与えています。\\n\\n### カスタマイズ性\\n\\n
    #  カスタマイズ性に関しては、AndroidはホームスクリーンのレイアウトからOSの深いレベルまで、ユーザーがデバイスを自分のニーズに合わせて調整
    #  できる自由度を提供します。これにより、使用者は自分だけのユーザー体験を作り出すことができます。\\n\\n### 開放性とイノベーション\\n\\n
    #  Androidのオープンプラットフォーム戦略は、革新と競争を促進しています。異なるメーカーが独自の特色を打ち出しており、技術進歩が加速してい
    #  ます。この多様なエコシステムは、消費者に選択肢の豊かさをもたらし、ニーズに合った最適なデバイスを容易に見つけることができます。\\n\\n
    #  ### セキュリティとプライバシー\\n\\nセキュリティについては、Googleもまたプライバシー保護とデータの安全性に力を入れており、Play Protectなどの
    #  機能を通じてアプリの安全性を確保しています。また、定期的なセキュリティ更新はAndroidデバイスを守る上で重要な役割を果たしています。\\n\\n
    #  ### 結論\\n\\niPhoneが一貫性とシンプルさで優れているのに対し、Androidは自由度、価格のアクセシビリティ、多様なハードウェア選択肢、
    #  そしてイノヴェーションの促進によって、ユーザーにとって魅力的な選択肢となっています。ユーザーの選択を尊重し、それぞれのライフスタイルに合わせたカスタマイズが可能なAndroidは、
    #  多くの人々にとって最良の選択であると強く主張します。'), ('否定', '### Androidの優位性：現状分析と問題解決\\n\\nAndroidは市場シェアで優位に立つことから、多様なユーザーのニーズに応える幅広いデバイスが存在します。
    #  現状の問題は、特定の企業に縛られずにユーザーが自由に選択できる選択肢が多くあるという点です。Androidはオープンソースの利点を活かして、
    #  カスタマイズ性が高く、多種多様なアプリの選択肢を提供します。これにより、ユーザーは自分のニーズや予算に応じたスマートフォンを選ぶことが
    #  可能です。\\n\\nプランとしては、Androidのエコシステムをさらに拡大して、デバイス間の相互運用性を強化し、ユーザーエクスペリエンスを向上
    #  させることです。これにより、ユーザーは様々なデバイスをシームレスに連携させることができ、生活をより豊かにすることが可能になります。\\n\
    #  \n導入後のメリットとしては、ユーザーが自らのライフスタイルに合わせてデバイスを選び、よりパーソナライズされた経験を得られることです。ま
    #  た、価格競争により、より手頃な価格で高品質なデバイスが手に入りやすくなります。デメリットとしては、選択肢が多すぎることで消費者が選択に
    #  迷う可能性がありますが、これは情報提供の改善とユーザーサポートの強化で対応可能です。'), ('肯定', '### iOSの優位性：一貫性とセキュリテ
    #  ィ\\n\\nAndroidの多様性は魅力的ですが、iOSの一貫性とセキュリティはその優位性を強固なものにしています。iOSは全デバイスで統一されたユーザー体験を提供し、
    #  直感的な操作性と安定したパフォーマンスを実現します。多様性は選択の自由をもたらしますが、それが常にユーザーにとって最善とは限りません。
    #  選択の多さが混乱を招くこともあり、品質のバラつきに繋がる場合もあります。\\n\\nセキュリティに関して、Appleはプライバシー保護において業界
    #  をリードしており、定期的なソフトウェア更新を通してユーザーを保護しています。Androidプラットフォームでは多様なメーカーが存在するため、
    #  セキュリティパッチの配信が不均一であり、古いデバイスではサポート外となるケースも多いです。\\n\\nまた、iOSのエコシステムは、
    #  デバイス間のシームレスな連携を可能にし、ユーザーがApple製品を複数持っている場合、統合された体験を享受できます。
    #  例えば、Handoff機能はMacからiPhoneへ、またはその逆への作業の引き継ぎをスムーズに行えます。\\n\\n価格に関しては、
    #  確かにiOSデバイスは高価な傾向にありますが、その分、長期間にわたるソフトウェアサポートと高い再販価値があります。
    #  長期的な使用を考えた場合、コストパフォーマンスは意外に良いものです。\\n\\n最後に、iOSは開発者にとっても魅力的なプラットフォームです。
    #  統一されたハードウェアとソフトウェア環境は、アプリの最適化を容易にし、ユーザーにとってより洗練されたアプリ体験をもたらします。\\n\\n
    #  Androidの自由度は素晴らしいものの、iOSの提供する一貫性、セキュリティ、統合エコシステムは、多くのユーザーにとって重要な価値を持っています。'), ('否定', '### Androidの多様性とカスタマイズ性の利点\\n\\niOSの一貫性とセキュリティは確かに評価できますが、Androidの多様性とカスタマイズ性がもたらす利点は見過ごせません。Androidは、ユーザーが自身の好みやニーズに合わせてデバイスをカスタマイズできる自由度を提供します。これにより、ユーザーは自分だけの使いやすい環境を作り出すことができます。\\n\\n選択の幅が広いことは、一見すると混乱を招くかもしれませんが、実際には消費者にとって最適な価格帯や機能を備えたデバイスを見つける機会を提供します。安価なモデルから高性能なフラグシップモデルまで、Androidは幅広い選択肢を提供し、すべてのユーザーが自分の予算に合わせて最適なスマートフォンを選べます。\\n\\nセキュリティの面では、AndroidもGoogle Play Protectなどの機能を通じて安全を確保しており、オープンソースであるためセキュリティ研究者からのフィードバックを迅速に取り入れることができます。また、最新のAndroidデバイスは、月次のセキュリティアップデートを受け取ることが多く、メーカーによっては長期的なアップデートサポートを提供しています。\\n\\niOSが提供するエコシステムの統合性も魅力的ですが、AndroidユーザーはGoogleの強力なエコシステムを利用できます。Googleサービスは、多くのデバイスやプラットフォームで利用できるため、実質的にはAndroidユーザーも跨デバイスでシームレスな経験を享受できます。\\n\\n価格については、Androidデバイスは手頃な価格でありながら高性能なオプションを提供しており、最新技術を迅速に取り入れる傾向にあります。このため、技術の進化を追いたいユーザーにとっては、Androidが最適な選択となることも少なくありません。\\n\\n開発者にとっても、Androidは魅力的なプラットフォームです。より多様なデバイスに対応したアプリケーションを開発することができ、広範なユーザーベースにリーチすることが可能です。\\n\\n結論として、AndroidとiOSはそれぞれ異なる利点を持ちますが、Androidの多様性、カスタマイズ性、価格の柔軟性は、多くのユーザーにとって大きな魅力となっています。'), ('肯定', '### iOSの一貫性とセキュリティの強み\\n\\nAndroidのカスタマイズ性は確かに魅力的ですが、iOSの一貫したユーザー体験とセキュリティの厳格さは、多くの利用者にとっての大きな安心材料です。Appleはハードウェアとソフトウェアの両方を設計しており、この統合されたアプローチによって最適化されたパフォーマンスとセキュリティを実現しています。\\n\\niOSのセキュリティは、サンドボックス環境やApp Storeの厳格な審査プロセスにより強化されています。これにより、マルウェアや不正アプリのリスクが軽減されます。また、定期的なソフトウェアアップデートはすべてのデバイスに迅速に配信され、セキュリティパッチや機能改善を一貫して提供します。\\n\\niOSのユーザーインターフェースは直感的で、ユーザーが容易に操作を学び、習得できるよう設計されています。この一貫性は、年齢や技術的スキルに関わらず、すべてのユーザーが同じ高品質の体験を得られることを保証します。\\n\\nプライバシー保護においても、iOSはユーザーのデータを守るための先進的な機能を提供します。Appleはユーザーのプライバシーを第一に考え、データの収集と共有を最小限に抑えるポリシーを採用しています。\\n\\nエコシステムの統合性では、iOSデバイスはMac、iPad、Apple Watchとシームレスに連携し、iMessageやAirDropなどの機能を通じてユーザー間のコミュニケーションを便利にします。この連携は、個々のデバイスを超えた経験を提供することで、生産性と利便性を向上させます。\\n\\n開発者にとっても、iOSは魅力的なプラットフォームです。統一されたデバイス基盤によって、アプリの開発とメンテナンスが容易になり、品質の高いアプリケーションを市場に提供することができます。\\n\\nコストは高価に感じられるかもしれませんが、Apple製品の耐久性と再販価値を考慮すれば、長期的な視点で見たコストパフォーマンスは非常に高いと言えます。\\n\\nAndroidの多様性とカスタマイズ性が一部のユーザーにとっては魅力的な選択肢かもしれませんが、iOSの一貫性、セキュリティ、プライバシー保護、エコシステムの統合は、他に類を見ない利点をもたらし、多くのユーザーにとって最適な選択です。'), ('否定', '### Androidの柔軟性とアクセシビリティの長所\\n\\niOSの一貫性とセキュリティが一部のユーザーにとって魅力的であることは認めますが、Androidの柔軟性、アクセシビリティ、価値には独自の利点があります。\\n\\nまずカスタマイズ性についてですが、Androidはユーザーが自分のニーズに応じてインターフェースを自由に調整できる点で秀でています。これにより、ユーザーは自分だけの使いやすい環境を作り出せます。さらに、異なるメーカーが提供する多様なデバイスから選べるため、予算や機能の好みに合わせた選択が可能です。\\n\\nセキュリティに関しては、AndroidもPlay Protectなどの機能を搭載しており、アプリの安全性を確保しています。また、オープンソースであるため、コミュニティによるセキュリティの強化が行われ、迅速な問題解決が可能です。\\n\\n更新の配信についても、GoogleはProject Mainlineを通じて、セキュリティパッチをデバイスメーカーを介さずに直接配信する仕組みを導入しています。これにより、アップデートの速度と普及率が向上しました。\\n\\nプライバシー保護においても、Android 10以降、アプリのアクセス権限管理が強化され、ユーザーがより細かくプライバシー設定をコントロールできるようになりました。\\n\\nエコシステムに関しても、GoogleのサービスはiOSデバイスを含むあらゆるプラットフォームで利用可能であり、Androidデバイスは多様な製品との互換性を持ちます。例えば、ChromecastやGoogle Assistantをはじめとするスマートホームデバイスとの統合は、Androidの柔軟性をさらに強調しています。\\n\\n開発者にとっては、Androidのオープンなプラットフォームは、革新的なアプリの開発と実験を促進します。Play Storeへのアプリ公開も比較的容易であり、より多様なアプリケーションが生まれる土壌があります。\\n\\nコストパフォーマンスに関しても、Androidデバイスは幅広い価格帯で利用可能であり、高価なハードウェアに投資することなく、優れたスマートフォン体験を提供します。\\n\\n結局のところ、選択はユーザーのライフスタイルや価値観に依存しますが、Androidはその自由度とアクセシビリティにおいて、多くのユーザーにとって魅力的な選択肢となるでしょう。'), ('肯定', '### iOSの一貫性と統合性の強み\\n\\nAndroidの柔軟性とアクセシビリティは魅力的ですが、iOSにはそれを凌駕する強みがあります。\\n\\niOSの最大の利点はシステム全体の一貫性です。Appleはハードウェアとソフトウェアを一貫して設計し、最適化しています。これにより、デバイス間でのシームレスな連携と高度なパフォーマンスが保証され、ユーザー体験はより滑らかで直感的になります。\\n\\nセキュリティとプライバシー保護においても、iOSは業界をリードしています。定期的なアップデートはすべてのデバイスに迅速に配布され、セキュリティの脆弱性を即座に修正することが可能です。さらに、App Storeの厳格なレビュープロセスは、安全性が未確認のアプリがユーザーに届くリスクを最小限に抑えます。\\n\\nアップデートの普及率に関しても、iOSはAndroidよりもはるかに早く、広範囲にわたって最新のソフトウェアが導入されます。これにより、新機能や改善がすべてのユーザーにタイムリーに提供され、デバイスの長期的な価値が保持されます。\\n\\nエコシステムの統合性では、Appleの製品群は独自の連携機能を備え、Apple Watch、Mac、iPad、AirPodsとの間で緊密なインテグレーションを実現しています。これは、ユーザーが一つのアカウントやサービスを複数のデバイスで利用する際に、一貫した体験を享受できることを意味します。\\n\\n開発者にとっても、iOSは魅力的なプラットフォームです。利用者の購買力が高く、収益性の高いアプリを市場に提供するインセンティブがあります。\\n\\n最後に、品質に関しても、iOSデバイスは高品質な素材と精密な工学により、耐久性と長期間の使用に耐えうるデザインを提供しています。\\n\\nユーザーの選択は個々のニーズに基づくものですが、iOSはその一貫性、セキュリティ、エコシステムの統合性、そしてユーザー体験の質において優れた選択肢です。
    # """
    # Kind of Bot Model
    bot = "claude_3_opus_200k"
    title = str(result_title[0])
    question_message = f"あなたはディベートの審査員です。今回のテーマは「{title}」です。双方の主張を見て、どちらがディベートの勝者であるか決定し、その理由を500字以内で述べて下さい。{m}"
    # for chunk in client.send_message(bot, question_message):
    #     print(chunk["response"], end="", flush=True)
    
    # TODO implement
    return {
        'statusCode': 200,
        'body': json.dumps({
            "title": result_title,
            "comment": question_message
        }, ensure_ascii=False)
    }
